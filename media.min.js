/* Media - Testing css media queries in Javascript. Authors & copyright (c) 2012: WebLinc, David Knight, Zac Owen. */

(function(c){var p=c.document,q=p.getElementsByTagName("head")[0],h=c.getComputedStyle&&c.getComputedStyle(q,null)||q.currentStyle,r=p.documentElement,t=/\(\s*(not)?\s*(min|max)?-?([^:\s]+)\s*:\s*([^\s]+)\s*\)/,u=/(not)?\s*(\w*)/,n=0,s=0;c.Media={supported:!1,type:"all",queries:[],features:{width:0,height:0,"aspect-ratio":0,color:screen.colorDepth,"color-index":Math.pow(2,screen.colorDepth),"device-aspect-ratio":(screen.width/screen.height).toFixed(2),"device-width":screen.width,"device-height":screen.height,
monochrome:Number(2==screen.colorDepth),orientation:"landscape",resolution:96},getAbsValue:function(b){var a;return(a=b.match(/([\d\.]+)(px|em|rem|%|in|cm|mm|ex|pt|pc)/))?"em"==a[2]?16*a[1]:"pt"==a[2]?this.features.resolution/72*a[1]:a[1]:(a=b.match(/(\d+)[\/:](\d+)/))?a[1]/a[2]:(a=b.match(/([\d]+)(dpi|dppx|dpcm)/))?"dpcm"==a[2]?0.3937*a[1]:"dppx"==a[2]?96*a[1]:a[1]:b},parseMatch:function(b,a){var d="string"===typeof b?b.split(", "):b,f=d.pop(),e="all",c=f.split(" and "),m=c.length-1;do{var g=null,
j=!0,k=null,k=!0,l=!1;if(-1===c[m].indexOf("(")||(g=c[m].match(t))){if(g)var j=this.features[g[3]],h=this.getAbsValue(g[4]),l="not"===g[1],j="min"===g[2]?j>=h:"max"===g[2]?j<=h:"undefined"!==g[4]?j===h:j;else k=c[m].match(u)||["",""],l="not"===k[1],e=k[2]||e,k=e===this.type||"all"===e,a&&l&&(e="screen, print, speech, projection, handheld, tv, braille, embossed, tty".split(e).join(", ").replace(/(,\s){2}/,""));if(g&&(l&&j||!l&&!j)||!g&&(l&&k||!l&&!k))return d.length?this.parseMatch(d,a):!1}}while(m--);
return a&&{matches:!0,type:e,media:f}||!0},match:function(b){var a=n;b={matches:Media.parseMatch(b,!1),media:b,addListener:function(b){Media.queries[a].listeners||(Media.queries[a].listeners=[]);b&&Media.queries[a].listeners.push(b)},removeListener:function(b){var c=Media.queries[a];if(c)for(var e=0,h=c.listeners.length;e<h;e++)c.listeners[e]===b&&c.listeners.splice(e,1)}};n++;Media.queries.push({mql:b,listeners:null});return b},watch:function(b){clearTimeout(s);s=setTimeout(function(){var a=n;Media.setMutableFeatures();
do{var d=Media.queries[a],f=!1;if("undefined"!==typeof d&&((f=Media.parseMatch(d.mql.media))&&!d.mql.matches||!f&&d.mql.matches))if(d.mql.matches=f,d.listeners)for(var f=0,e=d.listeners.length;f<e;f++)d.listeners[f]&&d.listeners[f].call(c,d.mql,b)}while(a--)},10)},setMutableFeatures:function(){this.features.width=c.innerWidth||r.clientWidth;this.features.height=c.innerHeight||r.clientHeight;this.features["aspect-ratio"]=(this.features.width/this.features.height).toFixed(2);this.features.orientation=
this.features.height>=this.features.width?"portrait":"landscape"},listen:function(b){c.addEventListener?(c.addEventListener("resize",b),c.addEventListener("orientationchange",b)):c.attachEvent&&(c.attachEvent("onresize",b),c.attachEvent("onorientationchange",b))},init:function(){this.supported=1===parseFloat(h.height);this.type="screen print speech projection handheld tv braille embossed tty".split(" ")[parseFloat(h.zIndex)-1]||"all";this.features.resolution=screen.deviceXDPI||parseFloat(h.width);
this.setMutableFeatures();this.listen(this.watch)}};Media.init()})(window);