/* Media - Testing css media queries in Javascript. Authors & copyright (c) 2012: WebLinc, David Knight, Zac Owen. */

(function(c){var j=c.document,n=j.getElementsByTagName("head")[0],d=c.getComputedStyle&&c.getComputedStyle(n,null)||n.currentStyle,p=j.documentElement,r=/\(\s*(min|max)?-?([^:\s]+)\s*:\s*([^\s]+)\s*\)/,h=0,q=0;c.Media={supported:!1,type:"all",queries:{},features:{width:0,height:0,"aspect-ratio":0,color:screen.colorDepth,"color-index":Math.pow(2,screen.colorDepth),"device-aspect-ratio":(screen.width/screen.height).toFixed(2),"device-width":screen.width,"device-height":screen.height,monochrome:Number(2==
screen.colorDepth),orientation:"landscape",resolution:96},getAbsValue:function(b){var a;return(a=b.match(/([\d\.]+)(px|em|rem|%|in|cm|mm|ex|pt|pc)/))?"em"==a[2]?16*a[1]:"pt"==a[2]?Media.features.resolution/72*a[1]:a[1]:(a=b.match(/(\d+)[\/:](\d+)/))?a[1]/a[2]:(a=b.match(/([\d]+)(dpi|dppx|dpcm)/))?"dpcm"==a[2]?0.3937*a[1]:"dppx"==a[2]?96*a[1]:a[1]:b},parseMatch:function(b,a){var e="string"===typeof b?b.split(", "):b,m=e.pop(),c=-1!==m.indexOf("not "),f="all",k=m.split(" and "),l=k.length-1,d=!c;do{var g=
null,i=null;if(-1===k[l].indexOf("(")||(g=k[l].match(r))){if(g)var i=this.features[g[2]],h=this.getAbsValue(g[3]),i="min"===g[1]?i>=h:"max"===g[1]?i<=h:"undefined"!==g[3]?i===h:Number(i);else f=k[l].match(/(not)?\s*(\w*)/)[2]||f;if(g&&!i||!f===Media.type&&"all"!==f)return e.length?this.parseMatch(e,a):c}}while(l--);return a&&d&&{matches:d,type:c?"all, screen, print, speech, projection, handheld, tv, braille, embossed, tty".split(f).join(", ").replace(/(,\s){2}/,""):f,media:m}||d},match:function(b){var a=
h,b={matches:Media.parseMatch(b,!1),media:b,addListener:function(b){Media.queries[a].listeners||(Media.queries[a].listeners=[]);b&&Media.queries[a].listeners.push(b)},removeListener:function(b){var c=Media.queries[a];if(c)for(var d=0,f=c.listeners.length;d<f;d++)c.listeners[d]===b&&c.listeners.splice(d,1)}};h++;Media.queries[a]={mql:b,listeners:null};return b},watch:function(b){clearTimeout(q);q=setTimeout(function(){var a=h;Media.setMutableFeatures();do{var e=Media.queries[a],d=!1;if("undefined"!==
typeof e&&((d=Media.parseMatch(e.mql.media))&&!e.mql.matches||!d&&e.mql.matches))if(e.mql.matches=d,e.listeners)for(var d=0,j=e.listeners.length;d<j;d++)e.listeners[d]&&e.listeners[d].call(c,e.mql,b)}while(a--)},10)},setMutableFeatures:function(){this.features.width=c.innerWidth||p.clientWidth;this.features.height=c.innerHeight||p.clientHeight;this.features["aspect-ratio"]=(this.features.width/this.features.height).toFixed(2);this.features.orientation=this.features.height>=this.features.width?"portrait":
"landscape"},listen:function(b){c.addEventListener?(c.addEventListener("resize",b),c.addEventListener("orientationchange",b)):c.attachEvent&&(c.attachEvent("onresize",b),c.attachEvent("onorientationchange",b))},init:function(){this.supported=1===parseFloat(d.height);this.type="all screen print speech projection handheld tv braille embossed tty".split(" ")[parseFloat(d.zIndex)];this.features.resolution=screen.deviceXDPI||parseFloat(d.width);this.setMutableFeatures();this.listen(this.watch)}};Media.init()})(window);